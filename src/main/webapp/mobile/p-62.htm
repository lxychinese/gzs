<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<title>垄上工作室-网站建设高端品牌-广州网站建设-企业网站建设</title>

<meta name="keywords" content="网站建设，网页设计，广州网站建设，深圳网站建设，企业网站建设，垄上工作室，手机网站，微信营销、APP开发、扎根垄上" />
<meta name="description" content="垄上工作室专注网站建设及信息化咨询服务，提供完善的网站建设、移动端应用、企业微信大战略、3D虚拟仿真等一系列企业互联网解决方案，知名客户有欧派、索菲亚、王老吉、PICC、海天味业、珠江钢琴、例外服饰、广百集团、轻工集团、广州发展集团。" />



<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<meta name="apple-mobile-web-app-capable" content="yes" />


<!--<meta name="format-detection" content="telephone=no">-->

<link rel="stylesheet" href="/templates\default\style_m\style.css">

<link rel="stylesheet" href="/templates\default\style_m\media.css">

<script src="/templates\default\js\jquery-2.1.1.min.js"></script>

<script src="/templates\default\js\touch-0.2.14.min.js"></script>

<script src="/templates\default\js\TouchSlide.1.1.js"></script>

<script src="/templates\default\js\common.js"></script> 
<script src="/templates\default\js\load.js"></script> 
</head>
<body>

  <div class="menuCon" id="menuCon">

        <ul class="nav fixed">

            <li><a href="index.htm"><i></i>垄上首页</a></li>

            <li><a href="anli.htm"><i></i>经典案例</a></li>

            <li><a href="kehu.htm"><i></i>知名客户</a></li>

            <li><a href="contact.htm"><i></i>联系我们</a></li>

            <li><a href="web.htm"><i></i>网站建设</a></li>

            <li><a href="m.htm"><i></i>移动端</a></li>

            <li><a href="wei.htm"><i></i>微定制</a></li>

            <li><a href="3d.htm"><i></i>虚拟仿真</a></li>

            <li><a href="n.htm"><i></i>最新动态</a></li>


            <li><a href="service.htm"><i></i>服务流程</a></li>


        </ul>

      

    </div>
   
<header class="fixed">
	<a href="n.htm" class="goBack"></a>
	<a href="javascript:;" class="goBack" id="goBackBtn"></a>
     <h1>新闻详细</h1>
     <a href="javascript:;" class="headerMenu" id="headerMenu"></a>
     <a href="javascript:;" class="headerClose" id="closeBtn"></a>
 </header>
<section class="bgfd">
    <h2>Nginx能为前端开发带来什么？</h2>
    <p>日期：2016-03-16 14:16&nbsp;&nbsp;&nbsp;来源：<a href="index.htm">垄上工作室</a></p>
</section>
<article class="bgfd">
<p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">Nginx那么好，我想去看看。<br/>接连逛了两个书城后，我发现并没有Nginx相关的书籍。<br/>这就很奇怪！</p><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><img src="/ueditor/jsp/upload/image/20160316/1458108964748009917.png" alt="" style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; max-width: 100%;"/></p><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">Nginx，一名<span style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-weight: 700;">网红</span>（网络服务器红人…），就算没有自传和回忆录，争着介绍它的花边新闻也该有吧。</p><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">后来找到仅有的一两本书籍，也直接深入到“源码剖析”的阶段。写得并不十分满意，况且我还不需要这些。<br/>后来发现了原因，大概是因为<span style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-weight: 700;">“使用太简单了，都不值得出书”</span>。<br/>是的，Nginx把纷繁复杂的功能，浓缩成一份简单的配置，极易上手。<br/>当它呈现到你面前时，感觉独具匠心。</p><h2 id="nginx-nodejs" style="margin: 35px 0px 0px; padding: 0px 0px 5px; border-width: 0px 0px 1px; border-bottom-style: solid; border-bottom-color: rgb(221, 221, 221); vertical-align: baseline; font-size: 1.3rem; color: rgb(87, 76, 76); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">Nginx与NodeJs</h2><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">（这里的标题有点歧义。此处的NodeJs，皆引申为NodeJs所搭建的服务器。）</p><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">有人说，作为一名前端，<span style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-weight: 700;">我的真爱是NodeJs</span>。<br/>同时也认同，抛去性能之类的比较，单纯从实现的角度，NodeJs编写的服务器也能实现Nginx的各种功能。</p><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">这些我都赞成，但使用Nginx并不意味着抛弃NodeJs。事实上，它们并不冲突，还可以在一起愉快的玩耍。</p><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">在业内，这样的模型已很常见：资源转发，反向代理，静态资源处理，负载均衡，这些事情扔给Nginx来处理，只是几行配置的事情；同时在上游，让NodeJs去处理它最擅长的I/O等事情。</p><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">合理分配各自<span style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-weight: 700;">擅长</span>的事情，这样的思路，同样可以运用于前端开发中。</p><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">以前用NodeJs几百行实现的服务器功能，在npm与github的海洋里花尽心思去寻找的模块，也许在Nginx里是一条成熟的配置。它能帮其分担很多事情，节约了成本。</p><h2 id="-" style="margin: 35px 0px 0px; padding: 0px 0px 5px; border-width: 0px 0px 1px; border-bottom-style: solid; border-bottom-color: rgb(221, 221, 221); vertical-align: baseline; font-size: 1.3rem; color: rgb(87, 76, 76); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">场景一：环境切换</h2><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">前端开发中，经常面临多个部署环境切换的问题。<br/>我们通常用配hosts的方式去实现。更优化些，我们将机器的服务绑定了不同的域名：比如正式环境是a.qq.com，测试环境是test.a.qq.com。</p><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">然而在拓展性和易用性方面，还不足够好。<br/>而Nginx作为反向代理，就很容易处理资源转发的问题。</p><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">思路很简单：</p><blockquote style="margin: 10px 0px 0px; padding: 15px 20px; border-width: 0px 0px 0px 5px; border-left-style: solid; border-left-color: rgb(101, 123, 131); vertical-align: baseline; quotes: none; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background: rgb(246, 246, 246);"><ol style="list-style-type: none;" class=" list-paddingleft-2"><li><p>读取请求里的cookie，如果键名host_id有值，则代理到这个IP地址；</p></li><li><p>如果没有，则代理到默认的正式环境（此处举例为1.1.1.1）;</p></li></ol></blockquote><pre style="margin-top: 10px; margin-bottom: 10px; padding: 15px 20px; border: 0px; vertical-align: baseline; font-family: &#39;Source Code Pro&#39;, Consolas, Monaco, Menlo, Consolas, monospace; color: rgb(255, 255, 255); line-height: 22px; overflow: auto; border-radius: 6px; font-size: 14px; background-color: rgb(39, 40, 34);">set&nbsp;$env_id&nbsp;&quot;1.1.1.1&quot;;if&nbsp;(&nbsp;$http_cookie~*&nbsp;&quot;host_id=(\S+)(;.*|$)&quot;)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;set&nbsp;$env_id&nbsp;$1;
}

location&nbsp;/&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;proxy_set_header&nbsp;Host&nbsp;$host;
&nbsp;&nbsp;&nbsp;&nbsp;proxy_pass&nbsp;&nbsp;&nbsp;http://$env_id:80;
}</pre><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">那接下来的事情，就是<span style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-weight: 700;">怎样用最简便的方式，把IP种在cookie里？</span><br/>我们应用了nginx-http-footer-filter模块，html文件经过代理时，都注入了一小段js代码。</p><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">这段代码，会帮我们展示小菜单，点击某个环境时，则将IP种到cookie里，同时刷新页面，让Nginx完成环境切换。<br/><img src="/ueditor/jsp/upload/image/20160316/1458108964850072069.png" alt="" style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; max-width: 100%;"/></p><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">切换环境，如今只需点击一次。</p><h2 id="-sourcemap" style="margin: 35px 0px 0px; padding: 0px 0px 5px; border-width: 0px 0px 1px; border-bottom-style: solid; border-bottom-color: rgb(221, 221, 221); vertical-align: baseline; font-size: 1.3rem; color: rgb(87, 76, 76); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">场景二：SourceMap</h2><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">在线上环境调试Js代码是件麻烦的事情，因为目前合格的前端部署，代码都应经过压缩。性能问题是优化了，debug可不怎么方便。</p><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">而SourceMap正好可以解决此问题。</p><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">在最新的各版本浏览器里，如果满足：</p><ol style="list-style-type: none;" class=" list-paddingleft-2"><li><p>压缩后的js文件后面有<code style="margin: 0px 3px; padding: 1px 3px; border: 1px solid rgb(204, 204, 204); vertical-align: baseline; font-family: Menlo, Monaco, &#39;Andale Mono&#39;, &#39;lucida console&#39;, &#39;Courier New&#39;, monospace; text-shadow: rgb(255, 255, 255) 0px 1px; font-size: 0.9em; color: rgb(102, 102, 102); background: rgb(221, 221, 221);">//# sourceMappingURL=xxx.map</code>格式的注释</p></li><li><p>浏览器能正常访问到sourceMappingURL</p></li></ol><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">那么，就能把压缩过的代码还原。 要实现这样的功能，就必须：</p><ol style="list-style-type: none;" class=" list-paddingleft-2"><li><p>现网环境不带以上形式的注释，同时访问不到sourceMap（安全性考虑）</p></li><li><p>测试环境带注释，能访问sourceMap</p></li></ol><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">这样的模型，用<code style="margin: 0px 3px; padding: 1px 3px; border: 1px solid rgb(204, 204, 204); vertical-align: baseline; font-family: Menlo, Monaco, &#39;Andale Mono&#39;, &#39;lucida console&#39;, &#39;Courier New&#39;, monospace; text-shadow: rgb(255, 255, 255) 0px 1px; font-size: 0.9em; color: rgb(102, 102, 102); background: rgb(221, 221, 221);">反向代理+内容纂改</code>的思路再合适不过。<br/>每次构建编译时，我们会把sourceMap文件存放到一台机器（举例为1.1.1.1），命名为js文件名后加<code style="margin: 0px 3px; padding: 1px 3px; border: 1px solid rgb(204, 204, 204); vertical-align: baseline; font-family: Menlo, Monaco, &#39;Andale Mono&#39;, &#39;lucida console&#39;, &#39;Courier New&#39;, monospace; text-shadow: rgb(255, 255, 255) 0px 1px; font-size: 0.9em; color: rgb(102, 102, 102); background: rgb(221, 221, 221);">.map</code>后缀。随后，使用Nginx，通过这几行配置就能把此功能实现：</p><pre style="margin-top: 10px; margin-bottom: 10px; padding: 15px 20px; border: 0px; vertical-align: baseline; font-family: &#39;Source Code Pro&#39;, Consolas, Monaco, Menlo, Consolas, monospace; color: rgb(255, 255, 255); line-height: 22px; overflow: auto; border-radius: 6px; font-size: 14px; background-color: rgb(39, 40, 34);">location&nbsp;~&nbsp;\.js$&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;footer&nbsp;&quot;\n//#&nbsp;sourceMappingURL=$request_uri.map&quot;;&nbsp;&nbsp;&nbsp;&nbsp;footer_types&nbsp;&quot;*&quot;;
}</pre><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">只要经过代理，在chrome里，我们能看到每份被压缩过的js文件，都有一个对应的源码文件。<br/>你可以直接使用它来做打断点之类的操作，大大的提升了调试质量。<br/><img src="/ueditor/jsp/upload/image/20160316/1458108964889085792.png" alt="" style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; max-width: 100%;"/></p><h2 id="-" style="margin: 35px 0px 0px; padding: 0px 0px 5px; border-width: 0px 0px 1px; border-bottom-style: solid; border-bottom-color: rgb(221, 221, 221); vertical-align: baseline; font-size: 1.3rem; color: rgb(87, 76, 76); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">场景三：内容纂改</h2><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">其实在以上两个场景里，都涉及了“内容纂改”。<br/>无论是说“纂改”还是“劫持”，大家的印象都不是什么好事情，但另一方面，他们又可以让事情有趣起来。</p><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">统一介绍下，Nginx涉及纂改的模块有：</p><ul style="list-style-type: none;" class=" list-paddingleft-2"><li><p><a href="https://m.oschina.net/blog/156826" target="_blank" style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgb(37, 143, 184); text-decoration: none; outline: 0px;">nginx_http_footer_filter</a>：往文件的底部添加文字，可包含Nginx的内置变量；</p></li><li><p><a href="http://nginx.org/en/docs/http/ngx_http_addition_module.html" target="_blank" style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgb(37, 143, 184); text-decoration: none; outline: 0px;">nginx_http_addition_module</a>：从一个url去读取内容，将之添加到文件的头部或顶部；</p></li><li><p><a href="http://nginx.org/en/docs/http/ngx_http_sub_module.html" target="_blank" style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgb(37, 143, 184); text-decoration: none; outline: 0px;">nginx_http_sub_module</a>：替换字符</p></li></ul><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">除去上面两种场景，合理运用这些模块对应的配置，可以做出许多小工具，这是很有想象力的事情。<br/>单单针对移动web前端开发，就可以实现：</p><blockquote style="margin: 10px 0px 0px; padding: 15px 20px; border-width: 0px 0px 0px 5px; border-left-style: solid; border-left-color: rgb(101, 123, 131); vertical-align: baseline; quotes: none; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background: rgb(246, 246, 246);"><ol style="list-style-type: none;" class=" list-paddingleft-2"><li><p>将<a href="http://people.apache.org/~pmuellr/weinre-docs/latest/" target="_blank" style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgb(37, 143, 184); text-decoration: none; outline: 0px;">weinre</a>脚本插入到html里，让移动web调试更加便捷。</p></li><li><p>移动web经常用到localStorage优化首屏，但debug时又会受到干扰，通过一个按钮很方便的清除本地缓存。</p></li><li><p>手机APP内嵌页面，很难将其网址分享给另一个人。通过一个按钮就能生成url对应的二维码等</p></li></ol></blockquote><h2 id="-" style="margin: 35px 0px 0px; padding: 0px 0px 5px; border-width: 0px 0px 1px; border-bottom-style: solid; border-bottom-color: rgb(221, 221, 221); vertical-align: baseline; font-size: 1.3rem; color: rgb(87, 76, 76); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">场景四：本地映射</h2><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">在Windows下的前端抓包调试，Fiddler+Willow的能力毋庸置疑。<br/>而脱离了.NET体系的Linux和Mac，即使有一些代替工具，但某些方面还是略显不足。</p><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">比如：<span style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-weight: 700;">线上接口映射到本地文件</span>。<br/>想到Fiddler的本质也是一个代理，而开启一个有这样能力的Nginx服务，并不是太难的事情。</p><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">而且，我们可以做得更灵活，比如：</p><ul style="list-style-type: none;" class=" list-paddingleft-2"><li><p>同时支持慢速调试</p></li><li><p>同时支持目录层级映射</p></li><li><p>同时支持正则匹配</p></li><li><p>JSON返回的数据有可能是变化的（比如分页时候），同时支持动态数据</p></li></ul><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">这些场景，只运用到Nginx里的“<a href="http://www.linuxidc.com/Linux/2014-01/95493.htm" target="_blank" style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgb(37, 143, 184); text-decoration: none; outline: 0px;">rewrite规则</a>”。<br/>从参考的文档可以大致看到，rewrite规则非常灵活，能完成各种场景的转发。</p><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">最简单的模型中，我们把所有带<code style="margin: 0px 3px; padding: 1px 3px; border: 1px solid rgb(204, 204, 204); vertical-align: baseline; font-family: Menlo, Monaco, &#39;Andale Mono&#39;, &#39;lucida console&#39;, &#39;Courier New&#39;, monospace; text-shadow: rgb(255, 255, 255) 0px 1px; font-size: 0.9em; color: rgb(102, 102, 102); background: rgb(221, 221, 221);">cgi-bin</code>路径的请求，rewite到本地的一个服务，同时带上请求的所有参数，<br/>仅需这三行配置即可：</p><pre style="margin-top: 10px; margin-bottom: 10px; padding: 15px 20px; border: 0px; vertical-align: baseline; font-family: &#39;Source Code Pro&#39;, Consolas, Monaco, Menlo, Consolas, monospace; color: rgb(255, 255, 255); line-height: 22px; overflow: auto; border-radius: 6px; font-size: 14px; background-color: rgb(39, 40, 34);">location&nbsp;~&nbsp;/cgi-bin/*&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;^(.*)$&nbsp;http://127.0.0.1:8080/cgi-bin/&nbsp;last;
}</pre><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">后续的事情，可以在本地创建一个cgi-bin文件夹，在里面放置需要映射的文本，并开启服务到8080端口即可。</p><h2 id="-" style="margin: 35px 0px 0px; padding: 0px 0px 5px; border-width: 0px 0px 1px; border-bottom-style: solid; border-bottom-color: rgb(221, 221, 221); vertical-align: baseline; font-size: 1.3rem; color: rgb(87, 76, 76); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">场景五：移动侧调试</h2><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><code style="margin: 0px 3px; padding: 1px 3px; border: 1px solid rgb(204, 204, 204); vertical-align: baseline; font-family: Menlo, Monaco, &#39;Andale Mono&#39;, &#39;lucida console&#39;, &#39;Courier New&#39;, monospace; text-shadow: rgb(255, 255, 255) 0px 1px; font-size: 0.9em; color: rgb(102, 102, 102); background: rgb(221, 221, 221);">Fiddler</code>&nbsp;有一个勾选项&nbsp;<code style="margin: 0px 3px; padding: 1px 3px; border: 1px solid rgb(204, 204, 204); vertical-align: baseline; font-family: Menlo, Monaco, &#39;Andale Mono&#39;, &#39;lucida console&#39;, &#39;Courier New&#39;, monospace; text-shadow: rgb(255, 255, 255) 0px 1px; font-size: 0.9em; color: rgb(102, 102, 102); background: rgb(221, 221, 221);">Allow remote computers to connect</code>，并可以指定&nbsp;<code style="margin: 0px 3px; padding: 1px 3px; border: 1px solid rgb(204, 204, 204); vertical-align: baseline; font-family: Menlo, Monaco, &#39;Andale Mono&#39;, &#39;lucida console&#39;, &#39;Courier New&#39;, monospace; text-shadow: rgb(255, 255, 255) 0px 1px; font-size: 0.9em; color: rgb(102, 102, 102); background: rgb(221, 221, 221);">listen port</code>&nbsp;可以使得手机/其它终端通过将本机设为代理而访问本机环境，与&nbsp;<code style="margin: 0px 3px; padding: 1px 3px; border: 1px solid rgb(204, 204, 204); vertical-align: baseline; font-family: Menlo, Monaco, &#39;Andale Mono&#39;, &#39;lucida console&#39;, &#39;Courier New&#39;, monospace; text-shadow: rgb(255, 255, 255) 0px 1px; font-size: 0.9em; color: rgb(102, 102, 102); background: rgb(221, 221, 221);">hosts</code>&nbsp;配合会很实用。</p><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">这个功能，用Nginx也很容易做到。<br/>通过&nbsp;<code style="margin: 0px 3px; padding: 1px 3px; border: 1px solid rgb(204, 204, 204); vertical-align: baseline; font-family: Menlo, Monaco, &#39;Andale Mono&#39;, &#39;lucida console&#39;, &#39;Courier New&#39;, monospace; text-shadow: rgb(255, 255, 255) 0px 1px; font-size: 0.9em; color: rgb(102, 102, 102); background: rgb(221, 221, 221);">default_server</code>&nbsp;作为代理，手机终端通过设置网络代理为本机IP和相应的&nbsp;<code style="margin: 0px 3px; padding: 1px 3px; border: 1px solid rgb(204, 204, 204); vertical-align: baseline; font-family: Menlo, Monaco, &#39;Andale Mono&#39;, &#39;lucida console&#39;, &#39;Courier New&#39;, monospace; text-shadow: rgb(255, 255, 255) 0px 1px; font-size: 0.9em; color: rgb(102, 102, 102); background: rgb(221, 221, 221);">listen port</code>，从而可以访问本机的 Web 服务。</p><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">其中也是用到了<a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html" target="_blank" style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgb(37, 143, 184); text-decoration: none; outline: 0px;">ngx_http_proxy_module</a>模块的配置：</p><pre style="margin-top: 10px; margin-bottom: 10px; padding: 15px 20px; border: 0px; vertical-align: baseline; font-family: &#39;Source Code Pro&#39;, Consolas, Monaco, Menlo, Consolas, monospace; color: rgb(255, 255, 255); line-height: 22px; overflow: auto; border-radius: 6px; font-size: 14px; background-color: rgb(39, 40, 34);">&nbsp;server&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;listen&nbsp;&nbsp;80&nbsp;default_server;
&nbsp;&nbsp;&nbsp;&nbsp;server_name&nbsp;&nbsp;localhost;
&nbsp;&nbsp;&nbsp;&nbsp;resolver&nbsp;8.8.8.8;
&nbsp;&nbsp;&nbsp;&nbsp;location&nbsp;/&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proxy_set_header&nbsp;Host&nbsp;$host;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proxy_set_header&nbsp;X-Real-Ip&nbsp;$remote_addr;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proxy_set_header&nbsp;X-Forwarded-For&nbsp;$remote_addr;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proxy_pass&nbsp;http://$host;
&nbsp;&nbsp;&nbsp;&nbsp;}
}

server&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;listen&nbsp;&nbsp;80;
&nbsp;&nbsp;&nbsp;&nbsp;server_name&nbsp;&nbsp;ke.qq.com;
&nbsp;&nbsp;&nbsp;&nbsp;location&nbsp;/&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proxy_set_header&nbsp;Host&nbsp;$host;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proxy_set_header&nbsp;X-Real-Ip&nbsp;$remote_addr;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proxy_set_header&nbsp;X-Forwarded-For&nbsp;$remote_addr;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proxy_pass&nbsp;http://127.0.0.1:9091/;
&nbsp;&nbsp;&nbsp;&nbsp;}
}</pre><h2 id="-" style="margin: 35px 0px 0px; padding: 0px 0px 5px; border-width: 0px 0px 1px; border-bottom-style: solid; border-bottom-color: rgb(221, 221, 221); vertical-align: baseline; font-size: 1.3rem; color: rgb(87, 76, 76); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">边角料</h2><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">除去特定场景，Nginx的一些配置也跟前端息息相关。以下简单罗列，作为边角材料。</p><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">1.<a href="https://github.com/alibaba/nginx-http-concat" target="_blank" style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgb(37, 143, 184); text-decoration: none; outline: 0px;">nginx_http_concat</a><br/>资源合并，处理CDN combo。例如通过这样的方式<code style="margin: 0px 3px; padding: 1px 3px; border: 1px solid rgb(204, 204, 204); vertical-align: baseline; font-family: Menlo, Monaco, &#39;Andale Mono&#39;, &#39;lucida console&#39;, &#39;Courier New&#39;, monospace; text-shadow: rgb(255, 255, 255) 0px 1px; font-size: 0.9em; color: rgb(102, 102, 102); background: rgb(221, 221, 221);">http://example.com/??style1.css,style2.css,foo/style3.css</code>访问合并后的资源。</p><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">2.<a href="http://nginx.org/en/docs/http/ngx_http_image_filter_module.html" target="_blank" style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgb(37, 143, 184); text-decoration: none; outline: 0px;">ngx_http_image_filter_module</a><br/>图片处理。提供图片缩放，jpg压缩，旋转等特性。</p><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">3.适配PC与移动web<br/>总体可运用<a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html" target="_blank" style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgb(37, 143, 184); text-decoration: none; outline: 0px;">ngx_http_proxy_module</a>，去实现路径转发。判断平台类型的Nginx配置，在开源项目<a href="http://detectmobilebrowsers.com/" target="_blank" style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgb(37, 143, 184); text-decoration: none; outline: 0px;">detectmobilebrowsers</a>中可以找到。</p><h2 id="-" style="margin: 35px 0px 0px; padding: 0px 0px 5px; border-width: 0px 0px 1px; border-bottom-style: solid; border-bottom-color: rgb(221, 221, 221); vertical-align: baseline; font-size: 1.3rem; color: rgb(87, 76, 76); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">后记</h2><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">学习Nginx，我本身只是出于开开眼界的目的。而的确发现了一些很有启发性的特质。<br/>于前端开发，无论线上线下，熟练掌握基本配置，可以做出许多提高效率的工具。<br/><span style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-weight: 700;">但既然是工具，熟手就好</span>。</p><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">比如Fiddler直观，但Nginx更底层，更灵活，应当按照实际选择即可。</p><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">话说回来，后来心情有些惆怅。<br/>想起之前，我用NodeJs写过一个八百行的本地调试服务，如今更习惯用Nginx的几行配置。<br/>不过我又想，<span style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-weight: 700;">既然我已经花了时间去写，为什么还要花时间去用？！</span></p><p style="margin-top: 10px; margin-bottom: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgba(0, 0, 0, 0.6); font-family: &#39;Microsoft YaHei&#39;, Verdana, Arial, Helvetica, sans-serif; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">心情又好起来了。（等等有什么不对，管它呢…）</p><p><br/></p>
</article>
<div class="share bgfd fixed">
    <span>分享</span>
    <div class="bdsharebuttonbox">
        <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
        <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a>
        <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
        <a href="#" class="bds_more" data-cmd="more"></a>
    </div>
    <script>
        window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
    </script>
</div>


<script type="text/javascript">
	$('article').imagesLoaded( function() {
		var wh = $(window).height();
		var bh = $('body').height();
		if (bh<wh) {
			$('body').height(wh);
		};
	});
</script>
    


</body>
</html>